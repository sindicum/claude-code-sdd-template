---
description: 初回実装 — PRDのP0機能を全て実装し、プロジェクトの基盤を構築する
---

# 初回実装 (完全自動実行モード)

**重要:** このワークフローは、ユーザーの介入なしに、開始から完了まで完全に自動で実行されるように設計されています。各ステップは完了後、ただちに次のステップへ移行してください。思考の途中でユーザーに確認を求めたり、作業を中断したりしないでください。

**用途:** `/setup-project` でドキュメント作成後の初回実装に使用します。`src/` が存在しないプロジェクトが対象です。

**引数:** なし（PRDのP0機能全てを対象とする）

---

## ステップ1: 準備とコンテキスト設定

1. 現在のタスクコンテキストを確立する:
  - 機能名: `initial-implementation`
  - 日付: `[現在の日付をYYYYMMDD形式で取得]`
  - `.steering/` 内の既存ディレクトリを走査し、最大の通し番号を取得（初回は001）
  - ステアリングディレクトリパス: `.steering/[NNN]_[日付]_initial-implementation/`
2. 上記ステアリングディレクトリを作成する。
3. 以下の3つの空ファイルを作成する:
  - `[ステアリングディレクトリパス]/requirements.md`
  - `[ステアリングディレクトリパス]/design.md`
  - `[ステアリングディレクトリパス]/tasklist.md`

## ステップ2: プロジェクト理解

1. `CLAUDE.md`を読み、プロジェクトの全体像を把握する。
2. `docs/`ディレクトリ内の永続ドキュメントを全て確認する:
  - `docs/product-requirements.md` — P0機能を全て抽出する
  - `docs/functional-design.md`
  - `docs/architecture.md` — 技術スタックを確認する
  - `docs/repository-structure.md` — ディレクトリ構造を確認する
  - `docs/development-guidelines.md`
  - `docs/glossary.md`

## ステップ3: P0機能の抽出

1. `docs/product-requirements.md` から P0（必須）機能を全て抽出する。
2. 抽出したP0機能を依存関係に基づいて実装順序を決定する。
3. **既存パターンの調査はスキップする**（初回実装のためソースコードが存在しない）。

## ステップ4: 計画フェーズ (ステアリングファイルの自動生成)

1. `Skill('steering')`を**計画モード**で実行し、ステップ1で作成した3つのファイル (`requirements.md`, `design.md`, `tasklist.md`) の内容を生成する。
2. **初回実装固有の計画内容**:
  - `requirements.md`: P0機能全てを要求として記載
  - `design.md`: 「プロジェクト初期構造」セクションを含む（技術スタック、プロジェクト構成、設定ファイル一覧）
  - `tasklist.md`: **フェーズ0（プロジェクトスキャフォールド）** を含む。以降のフェーズでP0機能を全て実装する計画を立てる
3. **このステップが正常に完了したら、決して停止せず、ただちにステップ5に進むこと。**

## ステップ5: 実装ループ (tasklist.mdの完全消化)

**このステップは、`tasklist.md`の全タスクが `[x]` になるまで自動で繰り返されるループ処理です。**
**このステップが正常に完了したら、決して停止せず、ただちにステップ6に進むこと。**

**ループ開始:**

1. タスクリストの読み込み:
  - `[ステアリングディレクトリパス]/tasklist.md`ファイルを読み込む。

2. 進捗の確認:
  - ファイル内に未完了タスク (`[ ]`) が存在するか確認する。
  - **もし未完了タスクが存在しない場合:** この実装ループは完了とみなし、ただちに**ステップ6**へ進む。
  - **もし未完了タスクが存在する場合:** 次の処理（3. タスクの実行）に進む。

3. タスクの実行:
  - `tasklist.md`の**先頭にある未完了タスク**を1つ特定する。
  - そのタスクを完了させるために必要な実装作業を実行する。
  - `Skill('steering')`を**実装モード**で使用する。
  - `Skill('development-guidelines')`のコーディング規約を常に遵守する。

4. タスクリストの更新:
  - 実行したタスクが完了したら、`Edit`ツールを使用して`tasklist.md`を更新し、該当タスクを `[ ]` から `[x]` に変更する。

5. ループ継続:
  - **ステップ5の先頭 (1. タスクリストの読み込み) に戻り、処理を繰り返す。**

---
### ※ 実装ループ内の例外処理ルール ※

実装ループの実行中に以下の状況が発生した場合は、このルールに従って自律的に対処し、ループを継続すること。

- **ルールA: タスクが大きすぎる場合**
  - **対処法:** 現在のタスクをより小さな複数のサブタスクに分割する。`Edit`ツールを使い、元のタスクを削除し、その場所に新しいサブタスク（`[ ]`付き）を挿入する。その後、ループを継続する。

- **ルールB: 技術的理由でタスクが不要になった場合**
  - **条件:** 実装方針の変更、アーキテクチャの変更、依存関係の変更など、明確な技術的理由がある場合にのみ適用。
  - **対処法:** `Edit`ツールを使い、該当タスクを `[x] ~~タスク名~~ (理由: [具体的な技術的理由を簡潔に記述])` の形式で更新する。その後、ループを継続する。

- **❌ 絶対禁止の行為:**
  - 未完了タスクを「後でやる」「別タスクにする」などの理由で意図的にスキップすること。
  - 理由なく未完了タスクを放置してループを終了させること。
  - ユーザーに判断を仰ぐこと。

---

## ステップ6: 実装検証 (サブエージェント起動)

1. `tasklist.md`の全タスクが完了したことを最終確認する。
2. `Task`ツールを使用し、`implementation-validator`サブエージェントを起動して品質を検証する。
  - `subagent_type`: "implementation-validator"
  - `description`: "Implementation quality validation"
  - `prompt`: "今回の初回実装に関する全ての変更点の品質を検証してください。対象ファイルは `[実装したファイルのパスリスト]` です。コーディング規約、エラーハンドリング、テスト可能性、docs/で定義されたパターンの確立を重点的に確認してください。"

**このステップが正常に完了したら、決して停止せず、ただちにステップ7に進むこと。**

## ステップ7: 自動テストの実行

1. 以下のコマンドを順番に実行し、全てのテストがパスすることを確認する。
  ```bash
  Bash('npm test')
  Bash('npm run lint')
  Bash('npm run typecheck')
  ```
2. いずれかのコマンドでエラーが発生した場合は、問題を分析し、修正コードを生成・適用してから、再度このステップを実行する。
3. テスト失敗による修正が発生した場合は、以下の情報を記録しておく（ステップ8で振り返りに記載する）。
  - 失敗したコマンド名とエラー概要
  - 原因分析
  - 適用した修正内容

**このステップが正常に完了したら、決して停止せず、ただちにステップ8に進むこと。**

## ステップ8: 振り返りとドキュメント更新

1. `Skill('steering')`を**振り返りモード**で実行し、`tasklist.md`に申し送り事項を記載する。
  - 実装完了日
  - 計画と実績の差分
  - テスト失敗による修正記録（ステップ7で発生した場合のみ）
  - 学んだこと
  - 次回への改善提案

2. 今回の変更がプロジェクトの基本設計やアーキテクチャに影響を与えるか判断する。

3. 影響がある場合、`docs/`内の関連する永続ドキュメントを`Edit`ツールで更新する。

4. `docs/product-requirements.md` から P1/P2 機能を抽出し、次のアクションとして案内する。

## ステップ9: Gitコミットの案内

実装完了後、ユーザーにGitコミットの案内メッセージを表示する（自動コミットは行わない）。

## 完了条件

このワークフローは、以下の全ての条件を満たした時点で自動的に完了となる。
- ステップ5: `tasklist.md`の全てのタスクが完了状態（`[x]`または正当な理由でスキップ）になっている。
- ステップ6: `implementation-validator`サブエージェントの検証をパスする。
- ステップ7: `test`, `lint`, `typecheck`の全てのコマンドがエラーなく成功する。
- ステップ8: `tasklist.md`に申し送り事項が記載されている。
この完了条件を満たすまで、自律的に思考し、問題解決を行い、作業を継続すること。

## 完了時のメッセージ

完了時にユーザーへ以下の形式で報告する:

```
「初回実装が完了しました!

実装したP0機能:
✅ [実装したP0機能のリスト]

💡 Gitコミットの案内:
以下のコマンドで変更をコミットできます。

  git add .
  git commit -m "feat: [機能名]の初回実装

  - [実装内容の箇条書き]"

Conventional Commits形式の例:
  feat(scope): 新機能の追加
  fix(scope): バグの修正
  docs(scope): ドキュメントの変更
  refactor(scope): リファクタリング

次のステップ（P1/P2機能）:
以下の機能がPRDに定義されています。
実装する場合は `/add-feature [機能名]` を実行してください。

P1（重要）:
- [P1機能名1]: [概要]
- [P1機能名2]: [概要]

P2（できれば）:
- [P2機能名1]: [概要]

（P1/P2機能がない場合は「なし」と記載）
」
```
