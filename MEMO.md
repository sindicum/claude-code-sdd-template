# Claude Code による Spec Driven Development（スペック駆動開発）テンプレートの使い方

本テンプレートはClaude Codeを用いたスペック駆動開発を実践するための雛形です。

---

## 使い方

1. 要件整理: 「壁打ちしたい」「アイデアを整理したい」等と伝えると create-initial-requirement スキルが起動し、対話を通じて要件を整理。成果物は `docs/ideas/initial-requirement.md` に出力される。（手入力で `docs/ideas/` にメモを置いてもOK）

2. /setup-projectコマンドで6つの永続的ドキュメントを生成し、Git初期化。`docs/ideas/` の内容を入力としてプロダクト要件定義が生成され、承認したら残り5ファイルが生成。最後にGitリポジトリ初期化とdevelopブランチ作成。`docs/ideas/` にファイルがない場合はコマンドが中断され、先にステップ1の実行を案内する。
   2-1. /docs/product-requirements.md（プロダクト要件定義）
   2-2. /docs/functional-design.md（機能設計）
   2-3. /docs/architecture.md（技術仕様）
   2-4. /docs/repository-structure.md（リポジトリ構造定義）
   2-5. /docs/development-guidelines.md（開発ガイドライン）
   2-6. /docs/glossary.md（ユビキタス言語定義）
3. review-docsコマンドでドキュメント間の整合性や記述の正確性をチェック・修正。サブエージェント（doc-reviewer）が起動し実行

4. initial-featureコマンドで初回実装。PRDのP0機能を全てスキャフォールドから実装し、developブランチにコミット（ユーザー承認制）。完了時にP1/P2機能の一覧と次のアクションが案内される。
5. add-featureコマンドでP1/P2機能を追加（以降、add-featureコマンドの繰り返し）。実装完了後にfeatureブランチを作成しコミット（ユーザー承認制）
6. /commitコマンドでスタンドアロンのGitコミットも可能（pushは手動）

---

## コマンド一覧

| コマンド                          | 内容                                                                                           |
| --------------------------------- | ---------------------------------------------------------------------------------------------- |
| `/setup-project`                  | 6つの永続的ドキュメントを順次生成し、Git初期化（developブランチ作成まで）                      |
| `/review-docs [ドキュメントパス]` | doc-reviewerサブエージェントでドキュメントの品質評価と改善提案                                 |
| `/initial-feature`                | 初回実装。P0機能全てをスキャフォールドから実装→検証→developブランチにコミット（ユーザー承認後） |
| `/add-feature [機能内容]`         | 機能追加。steeringスキルで実装→検証→featureブランチにコミット（ユーザー承認後）                |
| `/commit`                         | 変更をConventional Commits形式でコミット。git-operatorサブエージェントが分析・メッセージ生成   |
| `/commit [メッセージ]`            | メッセージ指定でコミット（例: `/commit feat(auth): ログイン追加`）                             |
| `/status`                         | ステアリングファイルに基づく現在の進行状況確認（tasklist.md の読み込み）                       |
| `/validate-design`                | docs/内のドキュメント間の整合性を検証。doc-reviewerサブエージェントを起動。                    |
| `/validate-gap`                   | 実装コードとdocs内の仕様書を比較し整合性を確認。implementation-validatorサブエージェントを起動 |

---

## スキル（.claude/skills/）

### steering

| 項目           | 内容                                 |
| -------------- | ------------------------------------ |
| **目的**       | ステアリングファイルの作成と進捗管理 |
| **許可ツール** | Read, Write, Edit                    |
| **出力先**     | `.steering/[NNN]_[YYYYMMDD]_[機能名]/` |

**3 つのモード**:

| モード             | 用途                     | 成果物                                  |
| ------------------ | ------------------------ | --------------------------------------- |
| モード 1: 作成     | ステアリングファイル作成 | requirements.md, design.md, tasklist.md |
| モード 2: 実装     | タスク進捗管理           | tasklist.md の `[ ]` → `[x]` 更新       |
| モード 3: 振り返り | 実装完了後の記録         | 振り返りセクション更新                  |

**重要な原則**:

- tasklist.md の全タスク完了が必須
- タスクスキップは技術的理由のみ許可
- TaskCreate/TaskUpdate は補助、tasklist.md が正式記録

**補足**:

- 上位のドキュメントが存在しないと、下位のスキルは実行不可または不完全になる
- `/setup-project` コマンドはこの順序で 6 つのドキュメントを作成する

### create-initial-requirement

| 項目           | 内容                                            |
| -------------- | ----------------------------------------------- |
| **目的**       | 壁打ち対話で「何を作るか」を明確にする要件整理  |
| **出力先**     | `docs/ideas/initial-requirement.md`              |
| **後続**       | `/setup-project` → prd-writing スキル            |

**3 フェーズの対話プロセス**:

| フェーズ                 | 目的                       |
| ------------------------ | -------------------------- |
| Phase 1: Capture（捕捉） | 何を、なぜ作りたいのか     |
| Phase 2: Explore（探索） | 機能の輪郭と境界を描く     |
| Phase 3: Prioritize      | MoSCoW 分類で優先度を決定  |

**トリガー**: 「壁打ちしたい」「アイデアを整理したい」「要件を整理したい」等

### prd-writing

| 項目           | 内容                                                |
| -------------- | --------------------------------------------------- |
| **目的**       | プロダクト要求定義書（PRD）の作成                   |
| **許可ツール** | Read, Write                                         |
| **入力**       | `docs/ideas/`（create-initial-requirement の出力）   |
| **出力先**     | `docs/product-requirements.md`                      |

**PRD に含めるもの**:

- プロダクトの概要と目的
- 前提条件・制約条件
- 機能要件（MVP/将来）
- 非機能要件
- スコープ外

**優先度の定義**（MoSCoW からの変換）:

| MoSCoW（入力） | PRD優先度（出力） | 意味                 |
| --------------- | ----------------- | -------------------- |
| Must            | P0（必須）        | MVPに含める機能      |
| Should          | P1（重要）        | 初期リリース後に追加 |
| Could           | P2（できれば）    | 将来的に検討         |
| Won't           | スコープ外        | 明示的に除外         |

### functional-design

| 項目           | 内容                                        |
| -------------- | ------------------------------------------- |
| **目的**       | 機能設計書の作成                            |
| **許可ツール** | Read, Write                                 |
| **出力先**     | `docs/functional-design.md`                 |
| **前提条件**   | PRD が存在すること（推奨: architecture.md） |

**含まれる内容**:

- システム構成図
- データモデル
- ユースケース（シーケンス図）
- エラーハンドリング
- API 設計

### architecture-design

| 項目           | 内容                       |
| -------------- | -------------------------- |
| **目的**       | アーキテクチャ設計書の作成 |
| **許可ツール** | Read, Write                |
| **出力先**     | `docs/architecture.md`     |
| **前提条件**   | PRDが存在すること          |

**含まれる内容**:

- システム構造
- 技術スタック（選定理由付き）
- レイヤードアーキテクチャ
- パフォーマンス要件
- セキュリティ考慮事項
- スケーラビリティ

### repository-structure

| 項目           | 内容                                                |
| -------------- | --------------------------------------------------- |
| **目的**       | リポジトリ構造定義書の作成                          |
| **許可ツール** | Read, Write                                         |
| **出力先**     | `docs/repository-structure.md`                      |
| **前提条件**   | PRD、機能設計書、アーキテクチャ設計書が存在すること |

**含まれる内容**:

- ディレクトリ構造（ツリー形式）
- 各ディレクトリの役割
- 命名規則
- 依存関係のルール
- スケーリング戦略

### development-guidelines

| 項目           | 内容                                                       |
| -------------- | ---------------------------------------------------------- |
| **目的**       | 開発ガイドラインの作成                                     |
| **許可ツール** | Read, Write, Edit                                          |
| **出力先**     | `docs/development-guidelines.md`                           |
| **前提条件**   | アーキテクチャ設計書、リポジトリ構造が存在すること（推奨） |

**2 つのサブガイド**:

| ガイド              | 内容                                                              |
| ------------------- | ----------------------------------------------------------------- |
| `implementation.md` | コーディング規約、命名規則、エラーハンドリング、テストコード      |
| `process.md`        | Git 運用（Git Flow）、コミットメッセージ、PR プロセス、テスト戦略 |

### glossary-creation

| 項目           | 内容                                     |
| -------------- | ---------------------------------------- |
| **目的**       | 用語集（ユビキタス言語）の作成           |
| **許可ツール** | Read, Write                              |
| **出力先**     | `docs/glossary.md`                       |
| **前提条件**   | 他の全ドキュメントが存在すること（推奨） |

**含まれる内容**:

- プロジェクト固有の用語定義
- 技術用語の定義
- 具体例
- 関連用語のリンク

---

## サブエージェント（.claude/agents/）

### doc-reviewer

| 項目       | 内容                                                                                  |
| ---------- | ------------------------------------------------------------------------------------- |
| **目的**   | ドキュメントの品質評価と改善提案                                                      |
| **モデル** | Sonnet                                                                                |
| **対象**   | PRD、機能設計書、アーキテクチャ設計書、リポジトリ構造定義書、開発ガイドライン、用語集 |

**評価観点**:

1. **完全性**: 必要なセクションが全て含まれているか
2. **明確性**: 用語の一貫性、定義の明確さ
3. **一貫性**: 他ドキュメントとの矛盾がないか
4. **実装可能性**: 開発者が実装に必要な情報が揃っているか
5. **測定可能性**: 成功基準が測定可能か

**出力形式**:

- 総合評価（5 段階スコア）
- 良い点（最低 3 つ）
- 改善が必要な点（必須/推奨/提案の優先度別）
- 次のステップ

### git-operator

| 項目       | 内容                                          |
| ---------- | --------------------------------------------- |
| **目的**   | Conventional Commitsに準拠したGitコミット支援 |
| **モデル** | Sonnet                                        |
| **対象**   | Git操作（ブランチ作成、コミット、状態確認）   |

**3つの操作モード**:

| モード             | 用途         | 内容                                          |
| ------------------ | ------------ | --------------------------------------------- |
| モード 1: ブランチ | ブランチ作成 | developの存在確認、feature/fix/\*ブランチ作成 |
| モード 2: コミット | コミット実行 | 変更分析→メッセージ生成→ユーザー確認→コミット |
| モード 3: 状態確認 | Git状態確認  | status, branch, log表示                       |

**安全原則**:

- `git push --force`, `git reset --hard`, `git clean -f` 禁止
- main/developへの直接コミット禁止
- 機密ファイル（`.env`, `*.pem`等）のコミット防止
- **ユーザー承認なしにコミットしない**（最重要）

### implementation-validator

| 項目       | 内容                                     |
| ---------- | ---------------------------------------- |
| **目的**   | 実装コードの品質検証とスペック整合性確認 |
| **モデル** | Sonnet                                   |
| **対象**   | 実装コード全般                           |

**検証観点**:

1. **スペック準拠**: PRD・機能設計・アーキテクチャとの整合性
2. **コード品質**: コーディング規約、命名、単一責務
3. **テストカバレッジ**: ユニットテスト、エッジケース（目標 80%以上）
4. **セキュリティ**: 入力検証、機密情報管理、認証・認可
5. **パフォーマンス**: データ構造、ループ最適化、メモリリーク

**実行ツール**:

- `npm run lint`
- `npm run typecheck`
- `npm test`
- `npm run build`

---

## サブエージェント・スキル・コマンド利用の基本的な考え方（参考）

### サブエージェント（Agents）= 「独立した検証・分析」

- 親エージェントのコンテキストを圧迫せずに、独立した検証・分析を実行する。

- 詳細な結果を親エージェントに返却
- 例: doc-reviewer, implementation-validator, git-operator

### スキル（Skills）= 「やり方」

- 具体的な作業の実行方法を定義
- プロジェクト固有のルール・知識を蓄積
- 例: prd-writing, steering, architecture-design

### コマンド（Commands）= 「流れ」

- 複数のスキルを順序立てて実行
- 定型的な作業手順を自動化
- 例: /setup-project, /add-feature

### まとめ

| 種別             | 追加基準                                     |
| ---------------- | -------------------------------------------- |
| サブエージェント | 大量読み込み・親コンテキスト分離が必要な検証 |
| スキル           | 成果物単位・タスク単位・ドメイン単位の知識   |
| コマンド         | 「毎回同じ手順を踏む」定型作業               |

---

## ヘッドレスモードによる完全自動化

- ドキュメントの準備ができたら、ヘッドレスモードで自動開発も可能
- --dangerously-skip-permissionsオプションを使うので、必ずdevcontainer内で実行する
- ステートレスな処理なので、終了後はコンテキストウィンドウが消える

```
cat prompt.md | claude -p --dangerously-skip-permissions \
  --output-format stream-json \
  --verbose 2>&1 | tee output.json
```

---

## .claudeディレクトリの引用元

1. [書籍「実践 Claude Code 入門（技術評論社）](https://github.com/GenerativeAgents/claude-code-book-chapter8)
2. [cc-sdd](https://github.com/gotalab/cc-sdd)
3. .devcontainerは[公式](https://code.claude.com/docs/ja/devcontainer)を採用

| ディレクトリ | 内容                        | 備考              |
| ------------ | --------------------------- | ----------------- |
| agents       | doc-reviewer.md             | 1を引用           |
| agents       | git-operator.md             | 新規作成          |
| agents       | implementation-validator.md | 1を引用           |
| commands     | add-feature.md              | 1を改変           |
| commands     | commit.md                   | 新規作成          |
| commands     | review-docs.md              | 1を引用           |
| commands     | setup-project.md            | 1を改変           |
| commands     | status.md                   | 新規作成          |
| commands     | validate-design.md          | 2を参考に新規作成 |
| commands     | validate-gap.md             | 2を参考に新規作成 |
| skills       | create-initial-requirement  | 新規作成          |
| skills       | architecture-design         | 1を改変           |
| skills       | development-guidelines      | 1を改変           |
| skills       | functional-design           | 1を改変           |
| skills       | glossary-creation           | 1を引用           |
| skills       | prd-writing                 | 1を引用           |
| skills       | repository-structure        | 1を改変           |
| skills       | steering                    | 1の改変           |
